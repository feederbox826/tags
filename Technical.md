## Format
Images are saved as lossless webp for their competitive lossless size savings and very good lossy size savings. While lossless does not compare with lossy compression, I wanted to maintain a high quality source image if I needed to reference or re-extract subtags from. Tags are always exported at a 1:1 W:H ratio, with some tags with 1px of difference.

Videos are saved as VP9 webm files with a 10MB/s VBR [^3]. This usually ends up instead at 1MB/s (cq35) with the goal length of 10s per tag, with leeway above and below those values. Videos are also exported at 1:1 ratio, usually at 720x720px, 1080x1080px, 2160x2160px

## Folder Format
There are 2 subfolders available at [`/media/original`](https://tags.feederbox.cc/media/original/)

- lowres
  - replaced with higher res alternatives or re-exported
  - videos with watermarks
  - factually incorrect videos/images
  - older low-resolution images (<720p)
- alt
  - alternative tag videos/images that are still good but weren't selected to be the main one for whatever other reason(s)
  - subsequent files with suffix ` (number)`, if there are 3+, a folder is created

### Quality
An optimized folder is generated by [webp-watcher](https://github.com/feederbox826/webp-watcher) at [`/media/optimized`](https://tags.feederbox.cc/media/optimized)

- original - full resolution
- optimized (default[^1])
  - webps at -q 80 (90% space savings, barely any quality reduction[^2])
  - thumbnails taken at 1s, with extension `.webm.webp`

## Caching
Because of the (relatively [^4]) static nature of the tags, caching is unfortunately unavoidable. The only analytics I run are from those proxied through CloudFlare. From Mar 4 to Apr 3, 2025 this is the bandwidth graph: ![March 4 to April 3, 2025 bandwidth](bandwidth.png) This makes caching an unfortunate reality as it saves me over 200GB of bandwidth. The entire tag repo is ~7GB, which equals ~36.7 people downloading the entire collection of tags.

Caddy is configured for 7 days Cache-Control with etags, Invalidation for updated tags in my experience happens within 1hr

## Sources
While I was not great with it initially, I have been trying to keep track of the sources of the tags. For images, this includes the original unedited source image, for videos this includes the StashDB URL and/or other source(s) iff it is not on StashDB. This also applies to `alt` and `lowres`

As of 2025-09-22, this amounts to ~382MB, available privately upon request or publicly if there is demand for it

## Backend
1. Tags downloaded with [stash-tag-sync](https://github.com/feederbox826/stash-tag-sync)
2. Gallery created with [caddy-browse-tags](https://github.com/feederbox826/caddy-browse-tags)

### Footnotes
[^1]: Since commit [e8a7305
](https://github.com/feederbox826/plugins/commit/e8a7305b385fff73ca5fa8fd829850db9dc5a8a7)
[^2]: Smaller and higher-quality than the `large` jpeg. You can see this for yourself at https://squoosh.app with Effort = 4, Quality = 80 (and "Auto adjust filter strength" enabled)
[^3]: After running a string of encoding settings (2025-04-10), 10k VBR seems to have a step up in distributing bitrate through the file compared to CBR
[^4]: As of 2025-09, I am mass-replacing tags with watermarks, but most of the maintence is *adding* tags which are not subject to cache